<!-- views/dashboard.ejs -->
<body class="bg-gray-100">
  <%- include('partials/header') %> 
  <%- include('nav_after') %>
  <div id="body" class="container mx-auto p-4">
    <%- include('quote', { quotes: quotes, user: user }) %>
  </div>
  <%- include('partials/footer') %>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      document.querySelectorAll(".like-btn").forEach((button) => {
        button.addEventListener("click", async () => {
          const id = button.getAttribute("data-id");
          try {
            await fetch(`/quotes/${id}/like/up`, { method: "PATCH" });
            updateQuoteCounts(id);
          } catch (error) {
            console.error("Error liking quote:", error);
          }
        });
      });

      document.querySelectorAll(".dislike-btn").forEach((button) => {
        button.addEventListener("click", async () => {
          const id = button.getAttribute("data-id");
          try {
            await fetch(`/quotes/${id}/dislike/up`, { method: "PATCH" });
            updateQuoteCounts(id);
          } catch (error) {
            console.error("Error disliking quote:", error);
          }
        });
      });

      const updateQuoteCounts = async (id) => {
        try {
          const response = await fetch(`/quotes/${id}`);
          if (response.ok) {
            const quote = await response.json();
            document.querySelector(
              `button[data-id="${id}"] .like-count`
            ).textContent = quote.likes || 0;
            document.querySelector(
              `button[data-id="${id}"] .dislike-count`
            ).textContent = quote.dislikes || 0;
          } else {
            console.error("Error fetching quote data:", response.statusText);
          }
        } catch (error) {
          console.error("Error fetching quote data:", error);
        }
      };
    });
  </script>
</body>
